name: HaftalÄ±k SÃ¼rÃ¼m ve Release KontrolÃ¼

on:
  schedule:
    # Haftada bir: Pazar gecesi 01:00'da Ã§alÄ±ÅŸÄ±r
    - cron: '0 1 * * 0'
  workflow_dispatch: # Manuel tetikleme iÃ§in buton ekler

permissions:
  contents: write # Release oluÅŸturmak iÃ§in yazma izni ÅŸart

jobs:
  check-and-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Depoyu Ã‡ek (Checkout)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Tag kontrolÃ¼ iÃ§in geÃ§miÅŸi Ã§ekmek Ã¶nemli

      - name: JSON Ä°ÅŸleyicisini (jq) YÃ¼kle
        run: sudo apt-get install -y jq

      - name: Mevcut Versiyonu Oku
        id: get_version
        run: |
          # data.json dosyasÄ±ndan versiyonu okur (Ã–rn: 1.7)
          # Dosya yoksa hata vermemesi iÃ§in kontrol ekliyoruz
          if [ -f data.json ]; then
            VERSION=$(jq -r .version data.json)
          else
            VERSION="1.0" # VarsayÄ±lan
          fi
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          echo "Tespit edilen yerel versiyon: $VERSION"

      - name: GitHub Tag KontrolÃ¼
        id: check_tag
        run: |
          # Git taglerinde bu versiyon var mÄ± bakar (v1.7 formatÄ±nda)
          if git rev-parse "v${{ env.VERSION }}" >/dev/null 2>&1; then
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "ğŸ›‘ Bu versiyon (v${{ env.VERSION }}) zaten yayÄ±nlanmÄ±ÅŸ. Ä°ÅŸlem iptal ediliyor."
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "âœ… Yeni versiyon tespit edildi: v${{ env.VERSION }}. HazÄ±rlÄ±k baÅŸlÄ±yor..."
          fi

      - name: DosyalarÄ± HazÄ±rla ve Ziple
        # Sadece tag yoksa (yani yeni sÃ¼rÃ¼mse) Ã§alÄ±ÅŸÄ±r
        if: steps.check_tag.outputs.exists == 'false'
        run: |
          echo "ğŸ“¦ Dosyalar zipleniyor..."

          # NOT: Zip komutu klasÃ¶rÃ¼ deÄŸil, Ä°Ã‡ERÄ°ÄÄ°NÄ° zipler.
          # BÃ¶ylece kullanÄ±cÄ± zipi aÃ§Ä±nca tekrar klasÃ¶rle uÄŸraÅŸmaz, direkt dosyalarÄ± gÃ¶rÃ¼r.

          # 1. Chrome.zip (Simple Version hariÃ§ tutulur, temiz paketleme)
          cd Chrome
          zip -r ../Chrome.zip . -x "Simple Version/*" -x "*.git*"
          cd ..
          
          # 2. Firefox.zip
          cd Firefox
          zip -r ../Firefox.zip . -x "*.git*"
          cd ..

          # 3. Simple Version.zip
          cd "Chrome/Simple Version"
          zip -r "../../Simple Version.zip" . -x "*.git*"
          cd ../..

          echo "âœ… Zipleme tamamlandÄ±:"
          ls -lh *.zip

      - name: Release OluÅŸtur ve YÃ¼kle
        # Sadece yeni sÃ¼rÃ¼mse Ã§alÄ±ÅŸÄ±r
        if: steps.check_tag.outputs.exists == 'false'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ env.VERSION }}
          name: SÃ¼rÃ¼m ${{ env.VERSION }}
          body: |
            ğŸ“… **Otomatik HaftalÄ±k SÃ¼rÃ¼m**
            
            Bu sÃ¼rÃ¼m, depodaki deÄŸiÅŸiklikler tespit edilerek otomatik oluÅŸturulmuÅŸtur.
            
            **Ä°ndirme SeÃ§enekleri:**
            - ğŸŸ  **Chrome & Chromium:** `Chrome.zip` (Ä°ndirip klasÃ¶re Ã§Ä±karÄ±n ve "PaketlenmemiÅŸ Ã¶ÄŸe yÃ¼kle" ile yÃ¼kleyin)
            - ğŸ¦Š **Firefox:** `Firefox.zip`
            - âš¡ **Hafif SÃ¼rÃ¼m:** `Simple Version.zip`
          draft: false
          prerelease: false
          files: |
            Chrome.zip
            Firefox.zip
            Simple Version.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
